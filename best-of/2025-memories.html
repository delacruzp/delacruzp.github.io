<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Theme color for mobile browsers (updated dynamically to match active background) -->
    <meta name="theme-color" content="#f1f5f9">
    <!-- Windows tile color -->
    <meta name="msapplication-TileColor" content="#f1f5f9">
    <!-- iOS web app / status bar hints -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <title>2025 Annual Recap</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body {
            background-color: #f1f5f9;
            overflow-x: hidden;
            margin: 0;
            color: #1e293b;
        }
        .perspective-container {
            perspective: 1200px;
            perspective-origin: center center;
        }
        .tunnel-scene {
            transform-style: preserve-3d;
            will-change: transform;
        }
        .tunnel-item, .category-header {
            transform-style: preserve-3d;
            will-change: transform, opacity, filter;
        }
        #bg-overlay {
            transition: background-color 1.5s ease;
        }
        .outline-text {
            -webkit-text-stroke: 2.5px rgba(30, 41, 59, 0.2);
            color: #00000019;
            text-transform: uppercase;
        }
        .selection-green::selection {
            background-color: #bbf7d0;
            color: #14532d;
        }
        .card-inner:hover {
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
        }

        /* Clamp titles to 3 lines and show ellipsis */
        .clamp-3 {
            display: -webkit-box;
            -webkit-box-orient: vertical;
            -webkit-line-clamp: 3;
            overflow: hidden;
            text-overflow: ellipsis;
            word-break: break-word;
        }

        /* Star rating display (shows up to 5 stars, partial fill via width) */
        .stars {
            position: relative;
            display: inline-block;
            line-height: 1;
        }
        .stars-back, .stars-front {
            white-space: nowrap;
            letter-spacing: 0.12em;
            font-size: 1rem;
            line-height: 1;
            font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
        }
        .stars-back {
            color: rgba(255,255,255,0.45);
        }
        .stars-front {
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            overflow: hidden;
            color: rgb(34 197 94 / 1);
            pointer-events: none;
        }

        /* Preserve line breaks in long review text */
        .preserve-whitespace {
            white-space: pre-wrap;
            word-break: break-word;
        }

        /* Stabilize viewport height on mobile using svh */
        .fixed-viewport {
            height: 100svh;
            min-height: -webkit-fill-available;
            width: 100%;
        }

        /* Background image active state (when clicking an image item) */
        #bg-overlay.bg-image-active {
            background-size: cover;
            background-position: center center;
            background-repeat: no-repeat;
            background-blend-mode: overlay;
            transition: background-image 0.8s ease, background-color 0.8s ease;
        }
    </style>
</head>
<body class="selection-green">

    <!-- Scroll Spacer -->
    <div id="scroll-spacer"></div>

    <!-- Fixed Viewport -->
    <div class="fixed inset-0 overflow-hidden fixed-viewport">
        <!-- Dynamic Background Layer -->
        <div id="bg-overlay" class="absolute inset-0 bg-slate-100 -z-20"></div>
        
        <!-- Subtle Grid -->
        <div id="grid-bg" class="absolute inset-0 opacity-20 -z-10" 
             style="background-image: radial-gradient(circle, #64748b 1px, transparent 1px); background-size: 80px 80px;">
        </div>

        <div class="perspective-container w-full h-full relative">
            <div id="tunnel-scene" class="tunnel-scene absolute inset-0 w-full h-full">
                
                <!-- Intro Heading -->
                <div id="intro-heading" class="absolute top-1/2 left-1/2 flex flex-col items-center justify-center text-center w-full"
                     style="transform: translate3d(-50%, -50%, 0px);">
                    <h1 class="text-8xl md:text-[12rem] font-black text-slate-800 tracking-tighter mb-4 opacity-90 leading-none italic">2025</h1>
                    <p class="text-sm md:text-base text-slate-500 uppercase tracking-[1em] font-bold leading-none pl-[1em]">Memories</p>
                    <div class="mt-24 animate-bounce text-slate-400">
                        <i data-lucide="chevron-down" class="mx-auto w-10 h-10"></i>
                        <span class="text-xs uppercase tracking-widest mt-4 block font-bold">Scroll forward</span>
                    </div>
                </div>

                <!-- Items will be injected here -->
                <div id="items-container" class="absolute inset-0" style="transform-style: preserve-3d;"></div>

                <!-- Outro -->
                <div id="outro-heading" class="absolute top-1/2 left-1/2 text-center w-full" style="display: none;">
                    <h2 class="text-6xl font-black text-slate-800 mb-6 tracking-tighter italic"></h2>
                    <p class="text-slate-400 uppercase tracking-[0.5em] text-xs font-bold">See you in 2026</p>
                </div>

            </div>
        </div>

        <!-- Progress UI -->
        <div class="fixed bottom-10 left-10 right-10 flex justify-between items-end pointer-events-none">
            <div class="text-left">
                <div id="active-category" class="text-[10px] font-black text-green-600 uppercase tracking-[0.4em] mb-4 transition-all duration-700">Voyage Status</div>
                <div class="w-64 h-1.5 bg-slate-200 rounded-full overflow-hidden pointer-events-auto border border-white/50 backdrop-blur-sm">
                    <div id="progress-bar" class="h-full bg-green-500" style="width: 0%"></div>
                </div>
            </div>
            <!-- <p id="z-plane-display" class="text-[9px] font-mono text-slate-500 bg-white/80 backdrop-blur-xl px-4 py-2 rounded-full border border-slate-200 uppercase tracking-widest shadow-sm">Depth: 0m</p> -->
        </div>
    </div>

    <!-- Modal Container -->
    <div id="modal-container" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-white/80 backdrop-blur-2xl" onclick="closeModal()"></div>
        <div id="modal-content" class="relative w-full max-w-xl bg-white rounded-[2rem] shadow-2xl overflow-hidden border border-slate-100 max-h-[90vh] flex flex-col text-slate-800">
            <!-- Modal data injected via JS -->
        </div>
    </div>

    <script>
        
        const INITIAL_DATA = {
            movies: [
                {
                    id: 'm1',
                    title: "A Nice Indian Boy",
                    year: "2024",
                    rating: 5,
                    site: "Letterboxd",
                    url: "https://letterboxd.com/delacruzp/film/a-nice-indian-boy/",
                    image: "/img/2025-m1.webp",
                    review: `I was laughing out loud through out this entire movie. The only moments when I was not laughing it was, because I was aggressively sobbing.

I must admit I was apprehensive going into this movie. But everything about it was SO f-ing good. Every single joke landed, my entire movie theater was enjoying the movie, which made the whole experience that more enjoyable.

I think it's my first time watching a movie, where the relationship with the parents it's not a zero sum game. It's not all in, neither all out. It's hard, complicated, awkward and at time sad, and still they keep trying to make it work.

I loved the splitting the movie into chapters. Love the way it tell the stories. Both the cutaways from the date, to the discussion of the date, and back. The sister narration. Ugh I love this movie.

Scenes where I cried:
• Naveen saying that of course he wants a wedding and love, and all the nice things.
• The mom saying that she was scared to say the wrong thing, and lose her kid forever.
• The dad saying that his kid has good taste.`,
                    quotes: [
                        "Are you waiting for a big speech to make you stay? Cuz I wont have one.",
                        "I know, I'm the dramatic one.",
                        "I don't want to hear sweeping notions of love. It's 2024, the world is burning!",
                        "We think it's wonderful that you're White.",
                    ]
                },
                {
                    id: 'm2',
                    title: "Tetris",
                    year: "2023",
                    rating: 4.5,
                    site: "Letterboxd",
                    url: "https://letterboxd.com/delacruzp/film/tetris/",
                    image: "/img/2025-m2.webp",
                    review: `This movie fucking slaps.

Who knew watching suits do capitalism could be that entertaining. 

Now let me go and play some tetris.`},
                {
                    id: 'm3',
                    title: "Sorry, Baby",
                    year: "2025",
                    rating: 4.5,
                    site: "Letterboxd",
                    url: "https://letterboxd.com/delacruzp/film/sorry-baby-2025/",
                    image: "/img/2025-m3.webp",
                    review: `I really enjoyed this.

Granted my expectations going into it where on the floor, but hey apparently that's the key to loving a movie.

Things I loved:
• The cinematography
• The shot of them seating by the beach, with the afro backlit, and glowing like a halo.
• The shot of the snow falling thorugh the window.
• The Jokes
• My dad is divorced.
• Are you safe, in your home? Yes. I have a cat.
• I'm gay, who would have guessed?

Honestly, too many to list. Which is why I loved this.
• The Plot
• The sandwich scene.
• The doctor asking questions without a tonal shift.
• The baby scene.
• The Acting

Dude. I just loved this movie. Bye.` },
                {
                    id: 'm4',
                    title: "Bugonia",
                    year: "2025",
                    rating: 4,
                    site: "Letterboxd",
                    url: "https://letterboxd.com/delacruzp/film/bugonia/",
                    image: "/img/2025-m4.webp",
                    review: "Can you diversify, the words, of the diversity training?"
                },
                {
                    id: 'm5',
                    title: "Eddington",
                    year: "Cinema",
                    rating: 4,
                    site: "Letterboxd",
                    url: "https://letterboxd.com/delacruzp/film/eddington/",
                    image: "/img/2025-m5.webp",
                    review: "So much could have been avoided if people were just nicer to each other."
                }
            ],
            books: [
                {
                    id: 'b1',
                    title: "Giovanni’s Room",
                    year: "1956",
                    rating: 5,
                    site: "Goodreads",
                    url: "https://www.goodreads.com/",
                    image: "/img/2025-b1.webp",
                    quotes: [
                        "Soon, it was too late to do anything but moan.",
                        "Maybe everything bad that happens to you makes you weaker... so you can stand less and less.",
                        "You will go home and then you will find that home is not home anymore. Then you will really be in trouble. As long as you stay here, you can always think: One day I will go home.",
                        "It is cruel to have made me want to live only to make my death more bloody.",
                        "You want to leave Giovanni because he makes you stink. You want to despise Giovanni because he is not afraid of the stink of love. You want to kill him in the name of all your lying little moralities. And you—you are immoral. You are, by far, the most immoral man I have met in all my life. Look, look what you have done to me.",
                        "Be careful. Please be careful. He gave me an ironical smile. ‘Thank you’, he said, 'You should have given me that advice the night we met”",
                        "What's the good of an American who isn't happy? Happiness was all we had.",
                    ]
                },
                {
                    id: 'b2',
                    title: "A Little Daylight Left: Poems",
                    year: "2025",
                    rating: 4,
                    site: "Goodreads",
                    url: "https://www.goodreads.com/book/show/215805885-a-little-daylight-left",
                    image: "/img/2025-b2.webp",
                },
                {
                    id: 'b3',
                    title: "The Seven Moons of Maali Almeida",
                    year: "2022",
                    rating: 4,
                    site: "Goodreads",
                    url: "https://www.goodreads.com/book/show/57224204-the-seven-moons-of-maali-almeida",
                    image: "/img/2025-b3.webp",
                    review: `A difficult read, worth the effort, like all best things.

I forgot how much I love a well thought-out story. A perfect ending is one of the few joys of life.

This booked pushed me, in more ways than one. I got to learned about the Sri Lanka civil war, the racial conflicts in the other side of the world, names that my tongue struggles to pronounced and stories that although noveled, brought up familiar emotions.

At the end of the day, the world keeps spinning, our efforts have a limited impact, our actions hurt our loved ones, but life is definitely not nothing.

New Word:
- Frock

Quotes that made me smile:
- That women has children to feed. That man has hospital to runs.You take photos, how impressive.
- His head is not between his shoulders, as heads prefer to be.
- I'm not your helper, sir. I only helped those that help me... -- You sound like the UN.
- Usually when you brought women home, which was about as frequent as free and fair elections...

Favorite Paragraphs:
- "Once you have seen your own face, and recognised the coulour of your eyes, tasted the air and smelled the soil, drunk from the purest fountains and the dirties wells, that is the kindest thing you can say about life, It's not nothing."
- "And right then with the moon in the sky, you realize you have nothing left to tell and no one to tell it to. You recognize this as a simple fact and are neither dismayed nor gladdened.
`,
                    quotes: [
                        "Despair always begins as a snack that you nibble on when bored and then becomes a meal that you have thrice a day.",
                        "That is the kindest thing you can say about life, It's not nothing.",
                        "Let's go to San Francisco and make money and love and let this shit country burn to the ground.",
                        "He was handsome and stout just the way you liked them, though you liked them many ways.",
                        "The one good thing you can say about a bomb is that it isn't racist or sexist or concerned about class.",
                        "Because a blow job isn't sex and it isn't sex if you don't see the other person's face and it doesn't count if you were thinking about him during it",
                        "Two promises are worth less than one.",
                        "Three promises are worth less than two.",
                        "We must all find pointless causes to live for, or why bother with breath?",
                        "How much money do you make? – I make what all the world's millionaires do not... What is that? – Enough.",
                        "We have fucked it up. All by ourselves.",
                        "She stares out the window and let water spills from her eyes. First a drop, then an eye full, then a fountain.",
                    ]
                },
                {
                    id: 'b4',
                    title: "Everything Is Tuberculosis: The History and Persistence of Our Deadliest Infection",
                    year: "2025",
                    rating: 4,
                    site: "Goodreads",
                    url: "https://www.goodreads.com/book/show/220341389-everything-is-tuberculosis",
                    image: "/img/2025-b4.webp",
                }
            ],
            essays: [
                {
                    id: 'e1',
                    title: "The Goon Squad",
                    year: "Nov, 2025",
                    author: "Daniel Kolitz",
                    site: "Harpers",
                    url: "https://harpers.org/archive/2025/11/the-goon-squad-daniel-kolitz-porn-masturbation-loneliness/",
                    image: "/img/2025-e1.webp",
                    site: "Harpers",
                    review: "Loneliness, porn’s next frontier, and the dream of endless masturbation."
                },
                {
                    id: 'e2',
                    title: "We’ve Reached Peak Gay Sluttiness",
                    year: "Aug 29, 2025",
                    author: "Steven Phillips-Horst",
                    site: "The Cut",
                    url: "https://www.thecut.com/article/ghb-doxypep-sniffies-peak-gay-sluttiness-era-nyc.html",
                    image: "/img/2025-e2.webp",
                    site: "The Cut",
                    review: "Party all weekend, hook up with anyone, never get an STD — or even a hangover. Who says nobody’s having sex anymore?"
                },
                {
                    id: 'e3',
                    title: "She Wanted to Save the World From A.I. Then the Killings Started.",
                    year: "Jul 6, 2025",
                    author: "Christopher Beam",
                    site: "NY Times",
                    url: "https://www.nytimes.com/2025/07/06/business/ziz-lasota-zizians-rationalists.html?smid=nytcore-android-share",
                    image: "/img/2025-e3.webp",
                    site: "NY Times",
                    review: "At first, Ziz LaSota seemed much like any other philosophically inclined young tech aspirant. Now, she and her followers are in jail, six people are dead, and Rationalists are examining whether their ideas played a role."
                },
                {
                    id: 'e4',
                    title: "We Bought a 450-Pound Mystery Pallet Packed With Returned Goods From Amazon and Beyond. Here’s What We Found Inside.",
                    year: "Nov 17, 2025",
                    author: "Annemarie Conte",
                    site: "NY Times",
                    url: "https://www.nytimes.com/wirecutter/reviews/mystery-amazon-pallet-unboxing/",
                    image: "/img/2025-e4.webp",
                    site: "Wirecutter",
                }
            ],
            images: [
                {
                    id: 'i1',
                    image: "/img/2025-i1.webp",
                    imageHd: "/img/2025-i1.jpg",
                },
                {
                    id: 'i2',
                    image: "/img/2025-i2.webp",
                    imageHd: "/img/2025-i2.jpg",
                },
                {
                    id: 'i3',
                    image: "/img/2025-i3.webp",
                    imageHd: "/img/2025-i3.jpg",
                },
                {
                    id: 'i4',
                    image: "/img/2025-i4.webp",
                    imageHd: "/img/2025-i4.jpg",
                },
                {
                    id: 'i5',
                    image: "/img/2025-i5.webp",
                    imageHd: "/img/2025-i5.jpg",
                }
            ],
            podcasts: [
                {
                    id: 'p1', title: "The Daily",
                    year: "Podcast",
                    rating: 5, url: "https://open.spotify.com/",
                    image: "https://images.unsplash.com/photo-1590602847861-f357a9332bbc?auto=format&fit=crop&q=80&w=1000",
                    review: "The standard for journalism. Their 2025 series on energy was particularly brilliant."
                }
            ]
        };

        const Z_DISTANCE = 1000;
        const INITIAL_OFFSET = 3000; 
        const CATEGORY_GAP = 3000;  
        const FOG_DEPTH = 4500;

        const THEMES = {
            "intro": "#f1f5f9",
            "movies": "#f1f5f9",
            "books": "#baf7e4",
            "essays": "#c2e0ff",
            "images": "#f1f5f9",
        };

        let allItems = [];
        let categoryHeaders = [];

        function init() {
            let currentZ = -INITIAL_OFFSET; 

            ['movies', 'books', 'essays', 'images'].forEach((type, idx) => {
                categoryHeaders.push({
                    title: type,
                    z: currentZ + (Z_DISTANCE * 0.5),
                    index: idx + 1
                });
                currentZ -= CATEGORY_GAP;
                INITIAL_DATA[type].forEach((item, itemIdx) => {
                    allItems.push({ ...item, type, z: currentZ, categoryIndex: itemIdx });
                    currentZ -= Z_DISTANCE;
                });
            });

            const totalHeight = Math.abs(currentZ)/5 + Z_DISTANCE * 1;
            document.getElementById('scroll-spacer').style.height = `${totalHeight}px`;
            console.log(`Scroll spacer height set to ${totalHeight}px`);

            const container = document.getElementById('items-container');
            
            categoryHeaders.forEach((header, idx) => {
                const el = document.createElement('div');
                el.className = 'category-header absolute top-1/2 left-1/2 flex flex-col items-center justify-center text-center w-full pointer-events-none';
                el.id = `header-${idx}`;
                el.style.transform = `translate3d(-50%, -50%, ${header.z}px)`;
                el.innerHTML = `
                    <div class="mb-4 flex items-center gap-6 opacity-40">
                        <div class="h-px w-24 bg-slate-400"></div>
                        <span class="text-[10px] font-black uppercase tracking-[0.5em] text-slate-500">Block 0${header.index}</span>
                        <div class="h-px w-24 bg-slate-400"></div>
                    </div>
                    <h2 class="outline-text text-[10rem] md:text-[18rem] font-black tracking-tighter leading-none select-none">${header.title}</h2>
                    <div class="mt-8 px-6 py-2 rounded-full border border-slate-200 bg-white/50 backdrop-blur-md text-[9px] font-bold text-slate-400 uppercase tracking-[0.4em]">
                        Archive Section
                    </div>
                `;
                container.appendChild(el);
            });

            allItems.forEach((item, index) => {
                const el = createItemElement(item, index);
                container.appendChild(el);
            });

            const outro = document.getElementById('outro-heading');
            outro.style.transform = `translate3d(-50%, -50%, ${currentZ - Z_DISTANCE}px)`;
            outro.style.display = 'block';

            lucide.createIcons();
            window.addEventListener('scroll', handleScroll);
            handleScroll();
        }

        function createItemElement(item, index) {
            const el = document.createElement('div');
            el.className = 'tunnel-item absolute top-1/2 left-1/2 w-80 -ml-40 -mt-56 cursor-pointer group';
            el.id = `item-${index}`;
            
            const seed = index * 456.78;
            const angle = seed % (2 * Math.PI);
            const radius = 300 + (seed % 450);
            var xFactor = 1.0;
            var yFactor = 0.8;
            if (window.width < window.height) {
                xFactor = 0.8;
                yFactor = 1.0;
            }
            const x = Math.cos(angle) * radius * xFactor;
            const y = Math.sin(angle) * radius * yFactor;

            el.dataset.x = x;
            el.dataset.y = y;
            el.dataset.z = item.z;
            el.dataset.type = item.type;

            el.innerHTML = `
                <div class="card-inner w-full h-[450px] bg-white rounded-[2rem] shadow-[0_30px_60px_-15px_rgba(0,0,0,0.1)] overflow-hidden border border-slate-200 transition-all duration-700 group-hover:scale-[1.03] group-hover:border-green-400 relative">
                    <!-- Edge-to-edge Image -->
                    <img src="${item.image}" alt="${item.title}" class="absolute inset-0 w-full h-full object-cover transition-transform duration-1000 group-hover:scale-110 opacity-90 group-hover:opacity-100">
                    
                    <!-- Overlay Gradient -->
                    <div class="absolute inset-0 bg-gradient-to-t from-slate-900 via-slate-900/10 to-transparent"></div>
                    
                    <!-- Content Overlay -->
                    <div class="absolute inset-x-0 bottom-0 p-8 flex flex-col items-start text-left ${item.type === 'images' ? 'hidden' : ''}">
                        <div class="flex items-center gap-3 mb-4">
                            <span class="bg-green-500 text-[9px] font-black text-white px-2.5 py-1 rounded uppercase tracking-tighter">
                                ${item.type}
                            </span>
                        </div>

                        <h3 class="font-black text-white text-3xl leading-none tracking-tighter mb-2 group-hover:text-green-400 transition-colors uppercase italic clamp-3 ">
                            ${item.title}
                        </h3>                        
                        <div class="h-0.5 w-8 bg-green-400 rounded-full transition-all duration-500 group-hover:w-full opacity-0 group-hover:opacity-100"></div>
                        ${item.rating ? `
                        <div class="mt-2 flex items-center gap-3">
                            <div class="stars" aria-hidden="true" title="${item.rating}">
                                <div class="stars-back">★★★★★</div>
                                <div class="stars-front" style="width: ${Math.round((Math.max(0, Math.min(5, item.rating))/5)*100)}%">★★★★★</div>
                            </div>
                            <div class="text-[10px] text-white/70 font-bold uppercase tracking-[0.2em]">${item.rating}</div>
                        </div>
                        ` : ''}                        
                        <p class="mt-4 text-[10px] text-white/70 font-bold uppercase tracking-[0.2em] group-hover:text-white transition-colors">My thoughts —></p>
                    </div>
                </div>
            `;

            el.addEventListener('click', () => openModal(item));
            return el;
        }

        function handleScroll() {
            const rawScroll = window.scrollY;
            const scrollY = rawScroll * 5;
            const scene = document.getElementById('tunnel-scene');
            const bgOverlay = document.getElementById('bg-overlay');
            
            scene.style.transform = `translateZ(${scrollY}px)`;
            document.getElementById('grid-bg').style.transform = `translateZ(0) translateY(${-scrollY * 0.1}px)`;

            const spacerEl = document.getElementById('scroll-spacer');
            const spacerHeight = parseInt(spacerEl.style.height) || spacerEl.offsetHeight;
            const maxScroll = Math.max(1, spacerHeight - window.innerHeight);
            console.log(`Spacer height: ${spacerHeight}px, Max scroll: ${maxScroll}px, window.scrollY: ${rawScroll}px, scaled scrollY: ${scrollY}px spacerEl.offsetHeight: ${spacerEl.offsetHeight}px window.innerHeight : ${window.innerHeight}px`);
            const rawProgress = (rawScroll / maxScroll) * 100;
            const progress = Math.min(100, Math.max(0, rawProgress));
            document.getElementById('progress-bar').style.width = `${progress}%`;

            const intro = document.getElementById('intro-heading');
            intro.style.opacity = Math.max(0, 1 - (scrollY / 1200));

            let currentActiveType = "";
            let activeTheme = THEMES.intro;

            categoryHeaders.forEach((header, idx) => {
                const el = document.getElementById(`header-${idx}`);
                const relativeZ = header.z + scrollY;
                let opacity = 0;
                
                if (relativeZ > 400) opacity = 0;
                else if (relativeZ > 0) opacity = 1 - (relativeZ / 400);
                else opacity = 1 - (Math.abs(relativeZ) / 2500);

                el.style.opacity = Math.max(0, opacity);
                
                if (relativeZ > -900 && relativeZ < 7000) {
                    currentActiveType = header.title;
                    activeTheme = THEMES[header.title];
                }
            });

            const bgOverlayEl = document.getElementById('bg-overlay');

            // Update background color and mobile theme/meta tags to match active section
            const themeMeta = document.querySelector('meta[name="theme-color"]');
            const msMeta = document.querySelector('meta[name="msapplication-TileColor"]');
            const appleMeta = document.querySelector('meta[name="apple-mobile-web-app-status-bar-style"]');

            let metaColor = activeTheme;
            if (!bgOverlayEl.dataset.imageActive) {
                bgOverlayEl.style.backgroundColor = activeTheme;
            } else {
                // when an image is active, use transparent so the image shows through
                metaColor = 'transparent';
            }

            if (themeMeta && themeMeta.content !== metaColor) themeMeta.content = metaColor;
            if (msMeta && msMeta.content !== activeTheme) msMeta.content = activeTheme;

            function isDarkHex(hex) {
                if (!hex || hex === 'transparent') return false;
                const c = hex.replace('#','');
                if (c.length !== 6) return false;
                const r = parseInt(c.substring(0,2),16);
                const g = parseInt(c.substring(2,4),16);
                const b = parseInt(c.substring(4,6),16);
                // Perceived brightness
                const brightness = (r * 299 + g * 587 + b * 114) / 1000;
                return brightness < 150;
            }

            if (appleMeta) {
                appleMeta.content = (metaColor === 'transparent' ? 'default' : (isDarkHex(metaColor) ? 'black-translucent' : 'default'));
            }

            document.getElementById('active-category').innerText = `${currentActiveType}`;

            allItems.forEach((item, index) => {
                const el = document.getElementById(`item-${index}`);
                const z = parseFloat(el.dataset.z);
                const x = parseFloat(el.dataset.x);
                const y = parseFloat(el.dataset.y);
                const relativeZ = z + scrollY;

                let opacity = 0;
                if (relativeZ > 250) opacity = 0;
                else if (relativeZ > 0) opacity = 1 - (relativeZ / 250);
                else if (relativeZ < -FOG_DEPTH) opacity = 0;
                else opacity = 1 - (Math.abs(relativeZ) / FOG_DEPTH);

                el.style.opacity = opacity;
                el.style.display = opacity <= 0.01 ? 'none' : 'block';
                el.style.filter = `blur(${Math.min(10, Math.abs(relativeZ) / 800)}px)`;
                el.style.transform = `translate3d(${x}px, ${y}px, ${z}px)`;
            });
        }

        function openModal(item) {
            const container = document.getElementById('modal-container');
            const content = document.getElementById('modal-content');
            const typeIcon = item.type === 'movies' ? 'film' : item.type === 'books' ? 'book-open' : 'pen-tool';

            if (item.type === 'images') {
                // Toggle the site background to this image instead of opening the modal
                const bg = document.getElementById('bg-overlay');
                const isActive = bg.dataset.imageActive === '1';
                const sameImage = bg.dataset.currentImage === item.image;
                if (!isActive || !sameImage) {
                    bg.dataset.imageActive = '1';
                    bg.dataset.currentImage = item.image;
                    bg.style.backgroundImage = `url('${item.image}')`;
                    bg.classList.add('bg-image-active');
                    // Make sure background color does not obscure the image
                    bg.style.backgroundColor = 'transparent';
                } else {
                    // Toggle off
                    delete bg.dataset.imageActive;
                    delete bg.dataset.currentImage;
                    bg.style.backgroundImage = '';
                    bg.classList.remove('bg-image-active');
                    // let handleScroll restore appropriate background color
                    handleScroll();
                }
                return;
            }

            content.innerHTML = `
                <button onclick="closeModal()" class="absolute top-8 right-8 z-10 p-3 bg-white/80 hover:bg-white text-slate-800 rounded-full backdrop-blur-xl transition-all border border-slate-200 group">
                    <i data-lucide="x" class="w-6 h-6 group-hover:rotate-90 transition-transform"></i>
                </button>
                <div class="h-80 shrink-0 relative">
                    <img src="${item.image}" class="w-full h-full object-cover">
                    <div class="absolute inset-0 bg-gradient-to-t from-white via-transparent to-transparent"></div>
                    <div class="absolute bottom-8 left-8 right-8">
                        <div class="flex items-center gap-3 mb-4">
                            <i data-lucide="${typeIcon}" class="w-5 h-5 text-green-600"></i>
                            <span class="text-xs font-black uppercase tracking-[0.4em] text-green-600">${item.type}</span>
                        </div>
                        <h2 class="text-3xl font-black text-slate-800 leading-none tracking-tighter italic clamp-3">${item.title}</h2>
                    </div>
                </div>
                <div class="p-10 pt-4 overflow-y-auto">
                    <div class="flex flex-wrap items-center gap-6 text-[10px] text-slate-400 mb-10 border-b border-slate-100 pb-8 font-black uppercase tracking-widest">
                        ${item.rating ? `
                            <div class="flex items-center gap-2">
                                <span class="text-slate-300">Rating:</span>
                                <div class="flex items-center gap-1.5 text-green-600">
                                    <span>${item.rating}</span> <i data-lucide="star" class="w-3 h-3 fill-current"></i>
                                </div>
                            </div>
                        ` : ''}
                        <a href="${item.url}" target="_blank" class="ml-auto flex items-center gap-2 text-slate-800 hover:text-green-600 transition-colors bg-slate-50 px-4 py-2 rounded-lg border border-slate-200">
                        ${item.site} <i data-lucide="external-link" class="w-3.5 h-3.5"></i>
                        </a>
                    </div>
                    
                    ${item.review ? `
                        <div class="mb-10">
                            <h4 class="text-[10px] font-black uppercase tracking-widest text-slate-300 mb-4">Review</h4>
                            <div class="text-slate-600 text-lg leading-relaxed font-medium preserve-whitespace">${item.review}</div>
                        </div>
                    ` : ''}
                    
                    ${item.quotes ? `
                        <div>
                            <h4 class="text-[10px] font-black uppercase tracking-widest text-slate-300 mb-6">Logs</h4>
                            <div class="space-y-8">
                                ${item.quotes.map(q => `
                                    <div class="relative pl-8">
                                        <div class="absolute left-0 top-1 bottom-1 w-1 bg-green-400 rounded-full"></div>
                                        <div class="text-slate-500 text-base leading-relaxed italic">"${q}"</div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    ` : ''}
                </div>
            `;

            container.classList.remove('hidden');
            lucide.createIcons();
            document.body.style.overflow = 'hidden';
        }

        function closeModal() {
            document.getElementById('modal-container').classList.add('hidden');
            document.body.style.overflow = '';
        }

        window.onload = init;
    </script>
</body>
</html>